"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var fs=require("fs"),projectPath=""+process.cwd();function declareControllers(e,r){void 0===e&&(e="src"),void 0===r&&(r=projectPath);var t=projectPath+"/"+e+"/controllers";if(!fs.existsSync(t))return fs.writeFileSync(projectPath+"/node_modules/restf/.allControllers.js","module.exports = {}");var n="module.exports = {\n";n+=fs.readdirSync(t).filter((function(e){return e.match(/^[A-Z].*\.[tj]s$/)})).filter((function(e){return!e.match(/\.(d|test|spec)\.[tj]s$/)})).map((function(e){return e.replace(/\.[tj]s$/,"")})).map((function(t){return"  "+t+": require('"+r+"/"+e+"/controllers/"+t+"').default,"})).join("\n"),n+="\n}",fs.writeFileSync(projectPath+"/node_modules/restf/.allControllers.js",n)}function declareModels(e){void 0===e&&(e="src");var r=function(r){return projectPath+"/"+e+"/"+r},t=function(e){return!fs.existsSync(r(e))};if(t("controllers")||t("models"))return null;var n=mountDeclareModelsContent(fs.readdirSync(r("models")).filter((function(e){return e.match(/[A-Z].*\.[tj]s$/)})).filter((function(e){return!e.match(/\.d\.[tj]s$/)})).map((function(e){return e.replace(/\.[tj]s$/,"")})).filter((function(e){return!e.match(/^(DB|ModelBase|DBBase|Model|Api)$/)})));return fs.writeFileSync(r("controllers")+"/_RestfControllerWithModels.ts",n)}function mountDeclareModelsContent(e){var r="//######################################\n";return r+="// This file is generated automatically,\n",r+="// Don't modify this file\n",r+="//######################################\n",r+="import RestfController from 'restf/controller'\n",r+=e.map((function(e){return"import "+e+" from '../models/"+e+"'"})).join("\n"),r+="\n\nexport default class RestfControllerWithModels extends RestfController {\n",(r+=e.map((function(e){return"  public get "+e+"() {\n    return new "+e+"(this.currentUser || {})\n  }"})).join("\n"))+"\n}\n"}projectPath.match(/node_modules\/restf/)&&(projectPath=projectPath.replace("/node_modules/restf","")),exports.declareControllers=declareControllers,exports.declareModels=declareModels;