"use strict";var __spreadArrays=this&&this.__spreadArrays||function(){for(var r=0,e=0,a=arguments.length;e<a;e++)r+=arguments[e].length;var t=Array(r),n=0;for(e=0;e<a;e++)for(var s=arguments[e],d=0,i=s.length;d<i;d++,n++)t[n]=s[d];return t};function addMiddleware(r,e,a){return function(t,n){try{fixEndingParams(t.params);var s=new t.AllControllers[r];s.req=t,s.res=n;var d=s.run.apply(s,__spreadArrays([e],middlewareParams(a,t)));return s.sent?d:isPromise(d)?d.then((function(r){return s.respondWith(r)})).catch(handleError(s)):s.respondWith(d)}catch(r){n.status(500),n.send("")}}}function fixEndingParams(r){if(r[0]){var e=r[0];delete r[0],r[Object.keys(r).pop()]+=e}}function handleError(r){return function(e){var a=500;return"Not Found"===e.message&&(a=404),r.respondWith({message:e.message,statusCode:a})}}function isPromise(r){return!!r&&void 0!==r.then}function middlewareParams(r,e){return/:/.test(r)?"/:id"===r?[e.params.id]:/:\w+\*/.test(r)?endingParam(r,e):Object.values(e.params):[]}function endingParam(r,e){var a=e.params,t=a[0]||"";delete a[0];var n=Object.keys(a).pop(),s=a[n]||"";return a[n]=s+t,Object.values(a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addMiddleware=addMiddleware;